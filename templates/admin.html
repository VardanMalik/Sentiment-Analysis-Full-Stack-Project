{% extends "base.html" %}
{% block content %}
<div class="container py-5 text-center">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Admin Dashboard</h2>
    <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Logout</a>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-6 mb-5">
      <h4 class="mb-3">Feedback Sentiment Breakdown</h4>
      <canvas id="sentimentChart" style="max-width: 100%;"></canvas>
    </div>
    <div class="col-md-6 mb-5">
      <h4 class="mb-3">Feedback by Star Rating</h4>
      <canvas id="ratingChart" style="max-width: 100%;"></canvas>
    </div>
  </div>

  <div class="mt-5 text-start">
    <h4 class="mb-4"> Total Feedbacks- {{ total_feedback }}</h4>
    {% for fb in feedbacks %}
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">{{ fb.name }} ({{ fb.rating }}⭐ - {{ fb.sentiment }})</h5>
        <p class="card-text">{{ fb.message }}</p>
        <p class="text-muted">Submitted on: {{ fb.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
        <form action="{{ url_for('delete_feedback', feedback_id=fb.id) }}" method="POST" style="display:inline-block">
          <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this feedback?')">Delete</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    new Chart(document.getElementById('sentimentChart').getContext('2d'), {
      type: 'doughnut',
      data: {
        labels: ['Positive', 'Neutral', 'Negative'],
        datasets: [{
          label: 'Sentiments',
          data: [{{ sentiments['Positive'] }}, {{ sentiments['Neutral'] }}, {{ sentiments['Negative'] }}],
          backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: { display: true, text: 'Feedback Sentiment Breakdown' }
        }
      }
    });

    new Chart(document.getElementById('ratingChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: ['1⭐', '2⭐', '3⭐', '4⭐', '5⭐'],
        datasets: [{
          label: 'Star Ratings',
          data: [
            {{ star_counts.get(1, 0) }},
            {{ star_counts.get(2, 0) }},
            {{ star_counts.get(3, 0) }},
            {{ star_counts.get(4, 0) }},
            {{ star_counts.get(5, 0) }}
          ],
          backgroundColor: '#4BC0C0'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Feedback by Star Rating' }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>
</div>
{% endblock %}
